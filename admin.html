<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>تمدونی — ادمین (ساده)</title>
  <link href="https://cdn.jsdelivr.net/npm/vazirmatn@33.003/fonts/variable/FD.css" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="./src/css/styles.css">
</head>
<body class="bg-slate-950 text-slate-50 font-sans">
  <main class="max-w-3xl mx-auto px-4 py-10 space-y-6">
    <h1 class="text-xl font-bold">ادمین — تمدونی</h1>

    <section class="card">
      <h2 class="section-title">تولید کد افزودن دوره</h2>
      <div class="grid md:grid-cols-2 gap-4">
        <div>
          <label class="label">شناسه هنرجو</label>
          <input id="studentId" class="input text-xs" placeholder="شناسه‌ای که هنرجو از پنلش فرستاده">
        </div>
        <div>
          <label class="label">شناسه دوره</label>
          <select id="courseId" class="input">
            <option value="sgtmarket_stickercoure">دوره آموزش ساخت و طراحی استیکر</option>
          </select>
        </div>
      </div>
      <div class="mt-4 flex gap-3">
        <button id="makeCode" class="btn-success">تولید کد</button>
        <button id="copyCode" class="btn-ghost">کپی کد</button>
      </div>
      <pre id="out" class="mt-3 text-xs bg-slate-800 p-3 rounded overflow-auto"></pre>
      <p class="hint">این کد را برای هنرجو بفرستید تا در پنل خودش وارد کند.</p>
    </section>
  </main>

  <script>
    const enc = new TextEncoder();
    const toB64u = (buf) => btoa(String.fromCharCode(...new Uint8Array(buf))).replace(/\+/g,'-').replace(/\//g,'_').replace(/=+$/,'');
    document.getElementById('makeCode').onclick = async () => {
      const studentId = document.getElementById('studentId').value.trim();
      const courseId = document.getElementById('courseId').value;
      if (!studentId) return alert('شناسه هنرجو را وارد کنید.');
      const payload = { v:1, studentId, courseId, ts: Date.now(), nonce: crypto.getRandomValues(new Uint32Array(1))[0] };
      const json = JSON.stringify(payload);
      const code = toB64u(enc.encode(json));
      document.getElementById('out').textContent = code;
    };
    document.getElementById('copyCode').onclick = async () => {
      const t = document.getElementById('out').textContent.trim();
      if (!t) return;
      await navigator.clipboard.writeText(t);
      alert('کپی شد.');
    };
  </script>
</body>
</html>